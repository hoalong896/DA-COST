generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model bao_cao {
  ma_bao_cao    Int        @id @default(autoincrement())
  ma_san_pham   Int
  ma_nguoi_dung Int
  ly_do         String
  trang_thai    String?    @default("ChuaXuLy")
  ngay_tao      DateTime?  @default(now())
  nguoi_dung    nguoi_dung @relation(fields: [ma_nguoi_dung], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
  san_pham      san_pham   @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
}

model cau_hoi {
  ma_cau_hoi   Int        @id @default(autoincrement())
  ma_san_pham  Int
  ma_nguoi_mua Int
  cau_hoi      String
  tra_loi      String?
  ngay_hoi     DateTime?  @default(now())
  ngay_tra_loi DateTime?
  nguoi_dung   nguoi_dung @relation(fields: [ma_nguoi_mua], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
  san_pham     san_pham   @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
}

model chi_tiet_don_hang {
  ma_ct        Int        @id @default(autoincrement())
  ma_don_hang  Int
  ma_san_pham  Int
  so_luong     Int
  don_gia      Float
  thanh_tien   Float
  ma_nguoi_ban Int
  don_hang     don_hang   @relation(fields: [ma_don_hang], references: [ma_don_hang], onDelete: NoAction, onUpdate: NoAction)
  nguoi_dung   nguoi_dung @relation(fields: [ma_nguoi_ban], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
  san_pham     san_pham   @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
}

model chi_tiet_gio_hang {
  ma_ct       Int       @id @default(autoincrement())
  ma_gio_hang Int
  ma_san_pham Int
  so_luong    Int
  ngay_tao    DateTime? @default(now())
  gio_hang    gio_hang  @relation(fields: [ma_gio_hang], references: [ma_gio_hang], onDelete: NoAction, onUpdate: NoAction)
  san_pham    san_pham  @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
}

model danh_gia {
  ma_danh_gia   Int        @id @default(autoincrement())
  ma_san_pham   Int
  ma_nguoi_mua  Int
  so_sao        Int
  noi_dung      String?
  ngay_danh_gia DateTime?  @default(now())
  nguoi_dung    nguoi_dung @relation(fields: [ma_nguoi_mua], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
  san_pham      san_pham   @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
}

model danh_muc {
  ma_danh_muc  Int        @id @default(autoincrement())
  ten_danh_muc String
  mo_ta        String?
  hien_thi     Boolean?   @default(true)
  ngay_tao     DateTime?  @default(now())
  parent_id    Int?
  parent       danh_muc?  @relation("CategoryHierarchy", fields: [parent_id], references: [ma_danh_muc])
  children     danh_muc[] @relation("CategoryHierarchy")
  san_pham     san_pham[]
}

model don_hang {
  ma_don_hang       Int                 @id @default(autoincrement())
  ma_nguoi_mua      Int
  tong_tien         Float?              @default(0.0)
  trang_thai        String?             @default("ChoXacNhan")
  ngay_dat          DateTime?           @default(now())
  ngay_cap_nhat     DateTime?           @default(now())
  chi_tiet_don_hang chi_tiet_don_hang[]
  nguoi_dung        nguoi_dung          @relation(fields: [ma_nguoi_mua], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
  thanh_toan        thanh_toan[]
}

model gio_hang {
  ma_gio_hang       Int                 @id @default(autoincrement())
  ma_nguoi_mua      Int
  ngay_tao          DateTime?           @default(now())
  chi_tiet_gio_hang chi_tiet_gio_hang[]
  nguoi_dung        nguoi_dung          @relation(fields: [ma_nguoi_mua], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
}

model nguoi_dung {
  ma_nguoi_dung          Int                      @id @default(autoincrement())
  ho_ten                 String
  email                  String                   @unique
  mat_khau               String
  dia_chi                String?
  so_dien_thoai          String?
  trang_thai             Boolean?                 @default(true)
  ngay_tao               DateTime?                @default(now())
  ngay_cap_nhat          DateTime?                @default(now())
  resetPasswordToken     String?
  resetPasswordExpire    DateTime?
  avatar                 String?
  dia_chi_cua_hang       String?
  ten_cua_hang           String?
  vai_tro                VaiTro                   @default(KHACH)
  bao_cao                bao_cao[]
  cau_hoi                cau_hoi[]
  chi_tiet_don_hang      chi_tiet_don_hang[]
  danh_gia               danh_gia[]
  don_hang               don_hang[]
  gio_hang               gio_hang[]
  nhat_ky_duyet_san_pham nhat_ky_duyet_san_pham[]
  san_pham               san_pham[]
}

model nhat_ky_duyet_san_pham {
  ma_nhat_ky    Int        @id @default(autoincrement())
  ma_san_pham   Int
  hanh_dong     String
  ly_do         String?
  thuc_hien_boi Int
  thuc_hien_luc DateTime?  @default(now())
  san_pham      san_pham   @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
  nguoi_dung    nguoi_dung @relation(fields: [thuc_hien_boi], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
}

model san_pham {
  ma_san_pham            Int                      @id @default(autoincrement())
  ten_san_pham           String
  mo_ta                  String?
  gia                    Float
  so_luong_ton           Int?                     @default(0)
  ma_nguoi_ban           Int
  ma_danh_muc            Int
  duyet_trang_thai       String?                  @default("ChoDuyet")
  ngay_dang              DateTime?                @default(now())
  ngay_cap_nhat          DateTime?                @default(now())
  tinh_trang             TinhTrang                @default(MOI)
  bao_cao                bao_cao[]
  cau_hoi                cau_hoi[]
  chi_tiet_don_hang      chi_tiet_don_hang[]
  chi_tiet_gio_hang      chi_tiet_gio_hang[]
  danh_gia               danh_gia[]
  nhat_ky_duyet_san_pham nhat_ky_duyet_san_pham[]
  danh_muc               danh_muc                 @relation(fields: [ma_danh_muc], references: [ma_danh_muc], onDelete: NoAction, onUpdate: NoAction)
  nguoi_dung             nguoi_dung               @relation(fields: [ma_nguoi_ban], references: [ma_nguoi_dung], onDelete: NoAction, onUpdate: NoAction)
  san_pham_anh           san_pham_anh[]
}

model san_pham_anh {
  ma_anh       Int       @id @default(autoincrement())
  ma_san_pham  Int
  url          String
  la_anh_chinh Boolean?  @default(false)
  thu_tu       Int?      @default(0)
  ngay_tao     DateTime? @default(now())
  san_pham     san_pham  @relation(fields: [ma_san_pham], references: [ma_san_pham], onDelete: NoAction, onUpdate: NoAction)
}

model thanh_toan {
  ma_thanh_toan Int       @id @default(autoincrement())
  ma_don_hang   Int
  so_tien       Float
  phuong_thuc   String
  trang_thai    String?   @default("ChoXuLy")
  ngay_tao      DateTime? @default(now())
  don_hang      don_hang  @relation(fields: [ma_don_hang], references: [ma_don_hang], onDelete: NoAction, onUpdate: NoAction)
}

enum TinhTrang {
  MOI
  TRUNG
  CU
}

enum VaiTro {
  KHACH
  NGUOI_BAN
  Admin
}
